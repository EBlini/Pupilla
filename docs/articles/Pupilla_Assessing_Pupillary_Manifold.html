<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Pupilla">
<title>Pupilla::Assessing_Pupillary_Manifold • Pupilla</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Pupilla::Assessing_Pupillary_Manifold">
<meta property="og:description" content="Pupilla">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">Pupilla</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1.01</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/Pupilla.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Pupilla_Advanced_statistical_analyses.html">Pupilla::Advanced_statistical_analyses</a>
    <a class="dropdown-item" href="../articles/Pupilla_Assessing_Pupillary_Manifold.html">Pupilla::Assessing_Pupillary_Manifold</a>
    <a class="dropdown-item" href="../articles/Pupilla_Eyelink_SingleSubjectPreprocessing.html">Pupilla::EyeLink::Read_and_preprocess</a>
    <a class="dropdown-item" href="../articles/Pupilla_TOBII_ReduceFeatures.html">Pupilla::TOBII::Reduce_Features</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/EBlini/Pupilla/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Pupilla::Assessing_Pupillary_Manifold</h1>
                        <h4 data-toc-skip class="author">Elvio
Blini</h4>
            
            <h4 data-toc-skip class="date">November 2024</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/EBlini/Pupilla/blob/HEAD/vignettes/Pupilla_Assessing_Pupillary_Manifold.Rmd" class="external-link"><code>vignettes/Pupilla_Assessing_Pupillary_Manifold.Rmd</code></a></small>
      <div class="d-none name"><code>Pupilla_Assessing_Pupillary_Manifold.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h3>
<p><code>Pupilla</code> gathers several functions that are designed to
facilitate the analysis of pupillometry experiments as commonly
performed in cognitive neuroscience, e.g. event-related designs,
although its use could be much more general.</p>
<p>The typical analysis pipeline would, coarsely, include the following
steps:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Read the data.</strong> This part can vary a lot
depending on the eyetracker used, the individual OS, local paths, how
the experiment was coded, etc. <code>Pupilla</code> does provide utility
functions to read from common eyetrackers (e.g., TOBII, EyeLink) but
clearly this passage will need to be tailored to your files.</p></li>
<li><p><strong>Prepare the data.</strong> As above, this part may need
to be tailored to your specific needs; however, several steps are very
common across pipelines, and will be presented in this
vignette.</p></li>
<li><p><strong>Preprocessing.</strong> Pupillometry needs robust
preprocessing of the raw data, in order to reduce noise and artifacts
(such as those due to blinks). Once the data is properly prepared, this
aspect can be translated across several different scenarios. Of course,
flexibility and adapting to your own data is warmly advised.</p></li>
<li><p><strong>Statistical modelling</strong>. <code>Pupilla</code>
offers two approaches: 1) crossvalidated LMEMs as in <a href="https://link.springer.com/article/10.3758/s13428-022-01957-7" class="external-link">Mathôt
&amp; Vilotijević, 2022</a>); and 2) an original approach through
feature/dimensionality reduction. This vignette covers and illustrates
the second option. In particular, we will show what we mean with
“assessing the pupillary manifold”, as outlined in the accompanying
paper.</p></li>
</ol>
<p>For this example we use data from <a href="https://www.biorxiv.org/content/10.1101/2024.05.23.595554v3" class="external-link">Blini,
Arrighi, and Anobile, 2024</a>. Data can be retrieved in full from the
associated <a href="https://osf.io/dkpcs" class="external-link">OSF repository</a>. If you
install <code>Pupilla</code> with the data included, however, you will
actually find the complete preprocessed data from Exp 1 (the “PLR” task)
included in the package, so that it will be extremely easy to lead them
in R (shown below).</p>
<p>In this task we asked 20 healthy, young participants to passively
watch a matrix of numbers change color/luminance level. Thus, the data
highlight the well known <strong>Pupillary Light Response
(PLR)</strong>. The aim of this vignette is to present how temporal PCA
and rotated temporal PCA can be implemented with
<code>Pupilla</code>.</p>
</div>
<div class="section level3">
<h3 id="read-the-data">Read the data<a class="anchor" aria-label="anchor" href="#read-the-data"></a>
</h3>
<p>The library <code>Pupilla</code> must be installed first, and only
once, through <code>devtools</code>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"EBlini/Pupilla"</span><span class="op">)</span></span></code></pre></div>
<p>Dependencies will be installed automatically. We will then need to
load the following packages:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/EBlini/Pupilla" class="external-link">"Pupilla"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://dplyr.tidyverse.org" class="external-link">"dplyr"</a></span><span class="op">)</span> </span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'dplyr'</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:stats':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     filter, lag</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:base':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     intersect, setdiff, setequal, union</span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org" class="external-link">"ggplot2"</a></span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>dplyr.summarise.inform <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Reading the data is straightforward in that the data come with the
package:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">plr</span><span class="op">)</span></span></code></pre></div>
<p>That’s it! Note that the recordings have been preprocessed already,
including baseline subtraction. We can plot the results:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plr</span><span class="op">$</span><span class="va">Luminance</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">plr</span><span class="op">$</span><span class="va">Luminance</span><span class="op">)</span></span>
<span></span>
<span><span class="va">colfunc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html" class="external-link">colorRampPalette</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"light gray"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">plr</span><span class="op">$</span><span class="va">Color</span><span class="op">=</span> <span class="fu">colfunc</span><span class="op">(</span><span class="fl">8</span><span class="op">)</span><span class="op">[</span><span class="va">plr</span><span class="op">$</span><span class="va">Luminance</span><span class="op">]</span></span>
<span></span>
<span><span class="va">plr</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Subject</span>, <span class="va">Luminance</span>, <span class="va">Time</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>Pupil<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Pupil</span><span class="op">)</span>, Color<span class="op">=</span> <span class="va">Color</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co">#between</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Luminance</span>, <span class="va">Time</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>SEM<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">Pupil</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            SEM<span class="op">=</span> <span class="fl">1.96</span><span class="op">*</span><span class="va">SEM</span>,</span>
<span>            Pupil<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Pupil</span><span class="op">)</span>,</span>
<span>            Color<span class="op">=</span> <span class="va">Color</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span> <span class="va">Time</span>, y<span class="op">=</span> <span class="va">Pupil</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>, linewidth<span class="op">=</span> <span class="fl">1</span>,</span>
<span>             color<span class="op">=</span> <span class="st">"gray"</span>, linetype<span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, linewidth<span class="op">=</span> <span class="fl">1</span>,</span>
<span>             color<span class="op">=</span> <span class="st">"gray"</span>, linetype<span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color<span class="op">=</span> <span class="va">Luminance</span><span class="op">)</span>,</span>
<span>            linewidth<span class="op">=</span> <span class="fl">1.2</span>, show.legend <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu">colfunc</span><span class="op">(</span><span class="fl">8</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin<span class="op">=</span> <span class="va">Pupil</span><span class="op">-</span><span class="va">SEM</span>,</span>
<span>                 ymax<span class="op">=</span> <span class="va">Pupil</span><span class="op">+</span><span class="va">SEM</span>, </span>
<span>                 fill<span class="op">=</span> <span class="va">Luminance</span><span class="op">)</span>,</span>
<span>             alpha<span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu">colfunc</span><span class="op">(</span><span class="fl">8</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>text<span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span> <span class="fl">16</span>,</span>
<span>                           face<span class="op">=</span><span class="st">"bold"</span>,</span>
<span>                           color<span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Time (ms)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Pupil size change (z scores)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"PLR: changes in pupil size"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1500</span>, <span class="fl">4500</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<p><img src="Pupilla_Assessing_Pupillary_Manifold_files/figure-html/raw_data-1.png" width="700"></p>
<p>As you can see, the brighter the luminance, the stronger the pupil
constriction, with peak values between 1-1.5 s, followed by pupil
escape.</p>
</div>
<div class="section level2">
<h2 id="dimensionality-reduction">Dimensionality reduction<a class="anchor" aria-label="anchor" href="#dimensionality-reduction"></a>
</h2>
</div>
<div class="section level2">
<h2 id="temporal-pca">temporal PCA<a class="anchor" aria-label="anchor" href="#temporal-pca"></a>
</h2>
<p>Temporal PCA attempts to summarise the data in fewer dimensions by at
the same time maximizing the amount of information retained. The scores
that can be obtained in this way are: 1. very handy to analyse 2. very
interpretable (but see below and the paper) 3. mindful of the factor
“time” (that is weighted in) 4. fully data-driven, hence less
arbitrary.</p>
<p>Temporal PCA in <code>Pupilla</code> is implemented as a wrapper
around <code><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">stats::prcomp()</a></code>, and is very straightforward (once
data have been preprocessed).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#this is not always necessary </span></span>
<span><span class="co">#but do make sure that "Time" is properly ordered</span></span>
<span><span class="va">plr</span><span class="op">=</span> <span class="va">plr</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">Subject</span>, <span class="va">trial</span>, <span class="va">Time</span><span class="op">)</span>  </span>
<span></span>
<span><span class="co">#you must include only timepoints with non-zero variance</span></span>
<span><span class="va">data</span><span class="op">=</span> <span class="va">plr</span><span class="op">[</span><span class="va">plr</span><span class="op">$</span><span class="va">Time</span><span class="op">&gt;</span> <span class="fl">0</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co">#for clarity, here's the variables needed</span></span>
<span><span class="va">dv</span><span class="op">=</span> <span class="st">"Pupil"</span></span>
<span><span class="va">time</span> <span class="op">=</span> <span class="st">"Time"</span> </span>
<span><span class="va">id</span> <span class="op">=</span> <span class="st">"Subject"</span></span>
<span><span class="va">trial</span> <span class="op">=</span>  <span class="st">"trial"</span></span>
<span><span class="va">Ncomp</span> <span class="op">=</span> <span class="fl">3</span> <span class="co">#not very relevant for PCA</span></span>
<span><span class="va">add</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Luminance"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Temporal PCA is actually only one function!</span></span>
<span><span class="va">plr_pca</span><span class="op">=</span> <span class="fu"><a href="../reference/reduce_PCA.html">reduce_PCA</a></span><span class="op">(</span><span class="va">data</span>, </span>
<span>                    dv<span class="op">=</span> <span class="va">dv</span>,</span>
<span>                    time <span class="op">=</span> <span class="va">time</span>, </span>
<span>                    id <span class="op">=</span> <span class="va">id</span>,</span>
<span>                    trial <span class="op">=</span>  <span class="va">trial</span>,</span>
<span>                    Ncomp<span class="op">=</span> <span class="va">Ncomp</span>,</span>
<span>                    add<span class="op">=</span> <span class="va">add</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in reduce_PCA(data, dv = dv, time = time, id = id, trial = trial, : NAs in the data will be discarded:</span></span>
<span><span class="co">##             check the data!</span></span></code></pre>
<p>There is an overly-sensitive reminder that PCA only works if you
<strong>do not</strong> have missing values for any timepoint. If any
value within one recording is missing, the respective trial will not be
considered for PCA. In other words: you cannot have trials of different
length or sampling rate or without imputation/interpolation of missing
values, and all the time points must be the same.</p>
<p>Apart for this, PCA with <code>Pupilla</code> ends here! Let’s look
at the object created this way:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">plr_pca</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "rs_mat"     "summaryPCA" "Loadings"   "Scores"     "PCA"       </span></span>
<span><span class="co">## [6] "scaling"</span></span></code></pre>
<p>The object is a list with the following entries:</p>
<ol style="list-style-type: decimal">
<li>
<strong>“rs_mat”</strong> is the matrix used for PCA, for your
reference. You probably will not need this, but it’s always good to
check whether the matrix has the dimensions that you expect.</li>
</ol>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">plr_pca</span><span class="op">$</span><span class="va">rs_mat</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 869 449</span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#rows are all trials from all participants</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">plr</span><span class="op">$</span><span class="va">Subject</span>, <span class="va">plr</span><span class="op">$</span><span class="va">trial</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 869</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#colums are the timepoints considered</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span></span>
<span>    <span class="va">plr</span><span class="op">$</span><span class="va">Time</span><span class="op">[</span><span class="va">plr</span><span class="op">$</span><span class="va">Time</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 449</span></span></code></pre>
<p>In the future this message may become more informative /
reassuring.</p>
<ol start="2" style="list-style-type: decimal">
<li><p><strong>“summaryPCA”</strong> is the summary returned by
<code><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp()</a></code>. It has all the components (the rows in your data)
together with the respective eigenvalues and share of explained
variance.</p></li>
<li><p><strong>“Loadings”</strong> are the eigenvectors for PCA and the
Loadings (proper) for rotated solutions. This may perhaps be changed in
the future, e.g. to “weights” for enhanced compatibility.</p></li>
<li><p><strong>“Scores”</strong> are, yes, the Scores, that is the
“strength” of one component in the low dimensional space.</p></li>
<li><p><strong>“PCA”</strong> is the object returned by
<code><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp()</a></code>. You may not need it directly though it is useful
for prediction of unobserved data, for example (see, e.g., the function
<code><a href="../reference/predict_feature.html">Pupilla::predict_feature()</a></code>).</p></li>
<li><p><strong>“scaling”</strong> is information about data scaling, if
relevant. This is mostly useful if you change the default settings -
which do not normalize or center the data because they assume you
already did baseline subtraction at very least - but then you want to
predict new, untrained data (which then should be normalized according
to the original values used in the model, see
<code><a href="../reference/predict_feature.html">Pupilla::predict_feature()</a></code>).</p></li>
</ol>
<p>In a typical pipeline, we can start by assessing the relative
contribution (to the explained variance) of each component.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plr_pca</span><span class="op">$</span><span class="va">summaryPCA</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="va">Ncomp</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##                             PC1      PC2      PC3</span></span>
<span><span class="co">## Standard deviation     30.88680 11.53209 7.752494</span></span>
<span><span class="co">## Proportion of Variance  0.78546  0.10950 0.049480</span></span>
<span><span class="co">## Cumulative Proportion   0.78546  0.89496 0.944440</span></span></code></pre>
<p>The first one can account for a very substantial share of the
variability, that is almost 80%. There are several helper functions to
depict the eigenvectors. For the depiction of single components you can
use:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_loadings.html">plot_loadings</a></span><span class="op">(</span><span class="st">"PC1"</span>, <span class="va">plr_pca</span><span class="op">)</span></span></code></pre></div>
<p><img src="Pupilla_Assessing_Pupillary_Manifold_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>Else, you can plot all components together with
<code><a href="../reference/plot_fingerprints.html">Pupilla::plot_fingerprints()</a></code>. I originally used the term
“fingerprints” assuming that certain changes in pupil size are the
signature of distinct physiological processes, though now I lean toward
thinking this is only applicable to rotated solutions (see below); for
those, however, I will reserve the term “pupillary manifold”, whereas
“fingerprints” can perhaps be more general and include all sorts of
latent constructs, regardless of their origin. In fact, this function
will work for temporal PCA, rotated PCA, and Independent Components
Analysis (ICA, not coped with here, though you do have functions for
that). The catch: for now this function only work when
<code>Ncomp== 3</code>; later on, it will be clearer why.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_fingerprints.html">plot_fingerprints</a></span><span class="op">(</span><span class="va">plr_pca</span><span class="op">)</span></span></code></pre></div>
<p><img src="Pupilla_Assessing_Pupillary_Manifold_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p>The function has options to reorder the variables or to flip their
sign (note that the sign of the eigenvectors is perfectly arbitrary in
PCA):</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_fingerprints.html">plot_fingerprints</a></span><span class="op">(</span><span class="va">plr_pca</span>, </span>
<span>                  order <span class="op">=</span> <span class="st">"peak"</span>, </span>
<span>                  flip <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in plot_fingerprints(plr_pca, order = "peak", flip = c(1, -1, 1)):</span></span>
<span><span class="co">## Warning: fingerprint names have been reordered following the explained</span></span>
<span><span class="co">## variance!</span></span></code></pre>
<p><img src="Pupilla_Assessing_Pupillary_Manifold_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>Then, you probably want to assess the scores. Scores are saved in the
dataframe returned by the <code>reduce_feature()</code> object. If you
have additional experimental variables to assess, you can add this piece
of information when performing PCA through the <code>add</code>
parameter. This way, the dataframe will have all the relevant
information, and you can proceed to modelling or plotting directly with
the dataframe provided.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pca_scores</span><span class="op">=</span> <span class="va">plr_pca</span><span class="op">$</span><span class="va">Scores</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">Luminance</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>PC1<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">PC1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Luminance</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>SEM<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">PC1</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            SEM<span class="op">=</span> <span class="fl">1.96</span><span class="op">*</span><span class="va">SEM</span>,</span>
<span>            PC1<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">PC1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">pca_scores</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Luminance</span>, y <span class="op">=</span> <span class="va">PC1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html" class="external-link">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    y <span class="op">=</span> <span class="va">PC1</span> <span class="op">-</span> <span class="va">SEM</span>,</span>
<span>    yend <span class="op">=</span> <span class="va">PC1</span> <span class="op">+</span> <span class="va">SEM</span>,</span>
<span>    xend <span class="op">=</span> <span class="va">Luminance</span></span>
<span>  <span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">Luminance</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    shape <span class="op">=</span> <span class="fl">21</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">5</span>,</span>
<span>    show.legend <span class="op">=</span> <span class="cn">F</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu">colfunc</span><span class="op">(</span><span class="fl">8</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Luminance"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"PC1 scores"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    text <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span></span>
<span>      size <span class="op">=</span> <span class="fl">16</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"bold"</span>,</span>
<span>      colour <span class="op">=</span> <span class="st">"black"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"PLR: strength"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Pupilla_Assessing_Pupillary_Manifold_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>Here we can see that the first component is a latent dimension along
which the PLR happens with distinct strength, and different luminance
conditions are well separable along this dimension. That the scores do
reflect the “strength of the PLR” is also suggested by the shape of the
eigenvector of PC1 seen above, which reflects our principled knowledge
of what the PLR should look like. Below we additionally map the strength
of the correlation between objective luminance levels and the scores of
this component.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plr</span><span class="op">$</span><span class="va">Luminance</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">plr</span><span class="op">$</span><span class="va">Luminance</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pca_cor</span><span class="op">=</span> <span class="va">plr_pca</span><span class="op">$</span><span class="va">Scores</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">Luminance</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>PC1<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">PC1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>R<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">PC1</span>, <span class="va">Luminance</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">M</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">pca_cor</span><span class="op">$</span><span class="va">R</span><span class="op">)</span></span>
<span><span class="va">SEM</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">pca_cor</span><span class="op">$</span><span class="va">R</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ymax</span><span class="op">=</span> <span class="va">M</span> <span class="op">+</span> <span class="fl">1.96</span><span class="op">*</span><span class="va">SEM</span></span>
<span><span class="va">ymin</span><span class="op">=</span> <span class="va">M</span> <span class="op">-</span> <span class="fl">1.96</span><span class="op">*</span><span class="va">SEM</span></span>
<span></span>
<span><span class="va">plr_mean</span><span class="op">=</span> <span class="va">plr</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Time</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Subject</span>, <span class="va">Time</span>, <span class="va">Luminance</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>Pupil<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Pupil</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Subject</span>, <span class="va">Time</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>R<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">Pupil</span>, <span class="va">Luminance</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Time</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>M<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">R</span><span class="op">)</span>, SEM<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">R</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">plr_mean</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span> <span class="va">Time</span>, y<span class="op">=</span> <span class="va">M</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, linetype<span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_rect</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xmin<span class="op">=</span> <span class="fl">10</span>, xmax<span class="op">=</span> <span class="fl">4490</span>, </span>
<span>                ymin<span class="op">=</span> <span class="op">-</span> <span class="va">ymin</span>, </span>
<span>                ymax<span class="op">=</span> <span class="op">-</span> <span class="va">ymax</span><span class="op">)</span>, </span>
<span>            fill<span class="op">=</span> <span class="st">"light blue"</span>, </span>
<span>            alpha<span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y<span class="op">=</span> <span class="va">M</span> <span class="op">-</span> <span class="fl">1.96</span><span class="op">*</span><span class="va">SEM</span><span class="op">)</span>, color<span class="op">=</span> <span class="st">"red"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y<span class="op">=</span> <span class="va">M</span> <span class="op">+</span> <span class="fl">1.96</span><span class="op">*</span><span class="va">SEM</span><span class="op">)</span>, color<span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Pearson's R"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1500</span>, <span class="fl">4500</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>text<span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span> <span class="fl">16</span>,</span>
<span>                                             face<span class="op">=</span><span class="st">"bold"</span>,</span>
<span>                                             colour<span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,</span>
<span>                 axis.text<span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>colour<span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"PLR: timecourse"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Pupilla_Assessing_Pupillary_Manifold_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<p>To conclude, temporal PCA represents a very handy approach, capable
to return few, very manageable values that are mindful of the temporal
aspect. On the other hand, as we discuss in the paper, the approach
should be used whenever we are fully confident that the process at hand
only involves one (or one major) process that we intend to isolate. For
example, when we add some sort of <strong>Working Memory Load
(WML)</strong> to the equation, that is different levels of cognitive
load and hence of the associated psychosensory dilation, the eigenvector
of the first component still captures the major axis of variability,
i.e. a mixture of the PLR and WML effects, without dissociating the
two.</p>
<p>As we discuss in the paper, at that point we may want to use
approaches that are not only mindful of the temporal aspects, but also
of the underlying physiology. This, we refer to as “assessing the
pupillary manifold”.</p>
</div>
<div class="section level2">
<h2 id="rotated-pca">Rotated PCA<a class="anchor" aria-label="anchor" href="#rotated-pca"></a>
</h2>
<p>rotated PCA is implemented in the package as wrappers around
<code><a href="https://rdrr.io/pkg/psych/man/principal.html" class="external-link">psych::principal()</a></code>. Please note that the function, even in
absence of rotations, produces slightly different results from
<code><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">stats::prcomp()</a></code> in light of several differences in
parametrization and analytical approach. Please refer to the excellent
<code>psych</code> package documentation for the differences between
<code><a href="https://rdrr.io/pkg/psych/man/principal.html" class="external-link">psych::principal()</a></code> and <code><a href="https://rdrr.io/pkg/psych/man/fa.html" class="external-link">psych::fa()</a></code>.</p>
<p>However, the implementation of rotated PCA is extremely similar to
that of regular PCA. The only extra bit of information required is the
rotation type - but the default is “promax”, and should do.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#again, just in case</span></span>
<span><span class="va">plr</span><span class="op">=</span> <span class="va">plr</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">Subject</span>, <span class="va">trial</span>, <span class="va">Time</span><span class="op">)</span>  </span>
<span></span>
<span><span class="co">#you must include only timepoints with non-zero variance</span></span>
<span><span class="va">data</span><span class="op">=</span> <span class="va">plr</span><span class="op">[</span><span class="va">plr</span><span class="op">$</span><span class="va">Time</span><span class="op">&gt;</span> <span class="fl">0</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co">#for clarity, here's the variables needed</span></span>
<span><span class="va">dv</span><span class="op">=</span> <span class="st">"Pupil"</span></span>
<span><span class="va">time</span> <span class="op">=</span> <span class="st">"Time"</span> </span>
<span><span class="va">id</span> <span class="op">=</span> <span class="st">"Subject"</span></span>
<span><span class="va">trial</span> <span class="op">=</span>  <span class="st">"trial"</span></span>
<span><span class="va">Ncomp</span> <span class="op">=</span> <span class="fl">3</span> <span class="co">#very relevant for rPCA</span></span>
<span><span class="va">add</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Luminance"</span><span class="op">)</span></span>
<span><span class="va">rotate</span><span class="op">=</span> <span class="st">"promax"</span> <span class="co">#new!</span></span>
<span></span>
<span><span class="co">#Temporal PCA is actually only one function!</span></span>
<span><span class="va">plr_rpca</span> <span class="op">=</span> <span class="fu"><a href="../reference/reduce_rPCA.html">reduce_rPCA</a></span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  dv <span class="op">=</span> <span class="va">dv</span>,</span>
<span>  time <span class="op">=</span> <span class="va">time</span>,</span>
<span>  id <span class="op">=</span> <span class="va">id</span>,</span>
<span>  trial <span class="op">=</span>  <span class="va">trial</span>,</span>
<span>  Ncomp <span class="op">=</span> <span class="va">Ncomp</span>,</span>
<span>  add <span class="op">=</span> <span class="va">add</span>,</span>
<span>  rotate <span class="op">=</span> <span class="va">rotate</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in reduce_rPCA(data, dv = dv, time = time, id = id, trial = trial, : NAs in the data will be discarded:</span></span>
<span><span class="co">##             check the data!</span></span></code></pre>
<pre><code><span><span class="co">## Warning in cor.smooth(r): Matrix was not positive definite, smoothing was done</span></span></code></pre>
<pre><code><span><span class="co">## The determinant of the smoothed correlation was zero.</span></span>
<span><span class="co">## This means the objective function is not defined.</span></span>
<span><span class="co">## Chi square is based upon observed residuals.</span></span></code></pre>
<pre><code><span><span class="co">## The determinant of the smoothed correlation was zero.</span></span>
<span><span class="co">## This means the objective function is not defined for the null model either.</span></span>
<span><span class="co">## The Chi square is thus based upon observed correlations.</span></span></code></pre>
<pre><code><span><span class="co">## Warning in psych::principal(rs_mat, nfactors = Ncomp, rotate = rotate): The</span></span>
<span><span class="co">## matrix is not positive semi-definite, scores found from Structure loadings</span></span></code></pre>
<p>You will inevitably see many warnings from <code>psych</code>. My
reading is that these warnings are harmless because only lamenting the
high dimensionality of the data, and the inability to tell whether a
<code>Ncomp</code> solution would be appropriate given the data. Then,
the only differences in the returned object are:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">plr_rpca</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "rs_mat"      "summaryPCA"  "summaryRPCA" "Loadings"    "Scores"     </span></span>
<span><span class="co">## [6] "rPCA"        "scaling"</span></span></code></pre>
<ol style="list-style-type: decimal">
<li><p>The model returned is not, of course, based on
<code><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp()</a></code> but on <code>principal()</code></p></li>
<li><p>On top of the PCA summary - which is still based on prcomp - you
can find the <strong>summaryRPCA</strong>, reporting the same
information but for the rotated solution.</p></li>
</ol>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plr_rpca</span><span class="op">$</span><span class="va">summaryRPCA</span></span></code></pre></div>
<pre><code><span><span class="co">##                               RC1         RC2        RC3</span></span>
<span><span class="co">## SS loadings           176.4576950 151.1138267 59.6308080</span></span>
<span><span class="co">## Proportion Var          0.3930015   0.3365564  0.1328080</span></span>
<span><span class="co">## Cumulative Var          0.3930015   0.7295580  0.8623660</span></span>
<span><span class="co">## Proportion Explained    0.4557248   0.3902710  0.1540043</span></span>
<span><span class="co">## Cumulative Proportion   0.4557248   0.8459957  1.0000000</span></span></code></pre>
<p>Notice that the overall explained variance is 86%, instead of 95% by
prcomp. This would also be the case with <code>rotate= "none"</code>,
and has to do with the internal parameters of <code>principal()</code>.
You can also see that the single components have also changed their
share of explained variance, this time in light of the rotation itself.
They account for a more even share of variance, i.e. 39% for rPC1 and
34% for rPC2.</p>
<p>You can use the same set of wrapper functions as above:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_fingerprints.html">plot_fingerprints</a></span><span class="op">(</span><span class="va">plr_rpca</span><span class="op">)</span></span></code></pre></div>
<p><img src="Pupilla_Assessing_Pupillary_Manifold_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<p>And you can assess the scores as well:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rpca_scores</span><span class="op">=</span> <span class="va">plr_rpca</span><span class="op">$</span><span class="va">Scores</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">Luminance</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>RC3<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">RC3</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Luminance</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>SEM<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">RC3</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            SEM<span class="op">=</span> <span class="fl">1.96</span><span class="op">*</span><span class="va">SEM</span>,</span>
<span>            RC3<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">RC3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">rpca_scores</span>, </span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Luminance</span>, y <span class="op">=</span> <span class="va">RC3</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html" class="external-link">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    y <span class="op">=</span> <span class="va">RC3</span> <span class="op">-</span> <span class="va">SEM</span>,</span>
<span>    yend <span class="op">=</span> <span class="va">RC3</span> <span class="op">+</span> <span class="va">SEM</span>,</span>
<span>    xend <span class="op">=</span> <span class="va">Luminance</span></span>
<span>  <span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">Luminance</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    shape <span class="op">=</span> <span class="fl">21</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">5</span>,</span>
<span>    show.legend <span class="op">=</span> <span class="cn">F</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu">colfunc</span><span class="op">(</span><span class="fl">8</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Luminance"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"RC3 scores"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    text <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span></span>
<span>      size <span class="op">=</span> <span class="fl">16</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"bold"</span>,</span>
<span>      colour <span class="op">=</span> <span class="st">"black"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Parasymphatetic\nactivation strength"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Pupilla_Assessing_Pupillary_Manifold_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
<p>What changes is the likely meaning of the scores.</p>
</div>
<div class="section level2">
<h2 id="the-pupillary-manifold">The Pupillary Manifold<a class="anchor" aria-label="anchor" href="#the-pupillary-manifold"></a>
</h2>
<p>As we discuss more thoroughly in the paper, we rotated solution
returns a set of loadings that is extremely constant across different
tasks. In this sense it is unlikely to reflect some idiosyncratic to the
data. On the contrary, loadings are more likely to reflect hard
constraints of the underlying physiology or the signal itself. The
suggestion is made that the three components recovered in this way
reflects physiologically relevant processes:</p>
<ol style="list-style-type: decimal">
<li>
<strong>RC1</strong>: symphatetic activation</li>
<li>
<strong>RC2</strong>: parasymphatetic inhibition</li>
<li>
<strong>RC3</strong>: parasymphatetic activation</li>
</ol>
<p>The relative scores define where the pupil traces lie (their
coordinates) on a low-dimensional space reflecting the overall balance
of the autonomic nervous system. Thus, on top of being handy to analyze,
mindful of temporal aspects, completely data-driven, and so on, these
values are also physiologically meaningful.</p>
<p>The toolbox comes with wrapper functions for 3D plots through
<code>plot3D</code>, which is not installed by default with the package
- so <code>plot3D</code> should be installed manually.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plr_rpca</span><span class="op">$</span><span class="va">Scores</span><span class="op">$</span><span class="va">Luminance</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">plr_rpca</span><span class="op">$</span><span class="va">Scores</span><span class="op">$</span><span class="va">Luminance</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_manifold.html">plot_manifold</a></span><span class="op">(</span><span class="va">plr_rpca</span><span class="op">$</span><span class="va">Scores</span>,</span>
<span>              colvar <span class="op">=</span> <span class="st">"Luminance"</span>, </span>
<span>              theta <span class="op">=</span> <span class="fl">30</span>, phi<span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span></code></pre></div>
<p><img src="Pupilla_Assessing_Pupillary_Manifold_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
<p>Finally, <code>gifski</code> (not installed automatically) provides
utilities to create GIFs from several different images. The function
<code><a href="../reference/animate_manifold.html">animate_manifold()</a></code> does precisely that: it creates a folder
populated with many <code><a href="../reference/plot_manifold.html">plot_manifold()</a></code> images taken from
different views, an saves a gif image in the current path.</p>
</div>
<div class="section level2">
<h2 id="appendix">Appendix<a class="anchor" aria-label="anchor" href="#appendix"></a>
</h2>
<p>Packages’ versions:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## R version 4.2.3 (2023-03-15 ucrt)</span></span>
<span><span class="co">## Platform: x86_64-w64-mingw32/x64 (64-bit)</span></span>
<span><span class="co">## Running under: Windows 10 x64 (build 19045)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">## [1] LC_COLLATE=Italian_Italy.utf8  LC_CTYPE=Italian_Italy.utf8   </span></span>
<span><span class="co">## [3] LC_MONETARY=Italian_Italy.utf8 LC_NUMERIC=C                  </span></span>
<span><span class="co">## [5] LC_TIME=Italian_Italy.utf8    </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">## [1] ggplot2_3.5.1    dplyr_1.1.4      Pupilla_0.1.1.01</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##  [1] highr_0.11        bslib_0.6.1       compiler_4.2.3    pillar_1.9.0     </span></span>
<span><span class="co">##  [5] jquerylib_0.1.4   tools_4.2.3       digest_0.6.34     nlme_3.1-162     </span></span>
<span><span class="co">##  [9] lattice_0.22-5    jsonlite_1.8.8    evaluate_1.0.1    memoise_2.0.1    </span></span>
<span><span class="co">## [13] lifecycle_1.0.4   tibble_3.2.1      gtable_0.3.6      pkgconfig_2.0.3  </span></span>
<span><span class="co">## [17] rlang_1.1.3       psych_2.4.1       cli_3.6.2         rstudioapi_0.15.0</span></span>
<span><span class="co">## [21] parallel_4.2.3    yaml_2.3.8        pkgdown_2.0.7     xfun_0.46        </span></span>
<span><span class="co">## [25] fastmap_1.1.1     withr_3.0.2       knitr_1.48        desc_1.4.3       </span></span>
<span><span class="co">## [29] generics_0.1.3    fs_1.6.3          vctrs_0.6.5       sass_0.4.9       </span></span>
<span><span class="co">## [33] systemfonts_1.0.5 plot3D_1.4.1      grid_4.2.3        tidyselect_1.2.1 </span></span>
<span><span class="co">## [37] glue_1.7.0        R6_2.5.1          textshaping_0.3.7 fansi_1.0.6      </span></span>
<span><span class="co">## [41] tcltk_4.2.3       rmarkdown_2.28    farver_2.1.2      purrr_1.0.2      </span></span>
<span><span class="co">## [45] magrittr_2.0.3    scales_1.3.0      htmltools_0.5.7   misc3d_0.9-1     </span></span>
<span><span class="co">## [49] mnormt_2.1.1      colorspace_2.1-0  labeling_0.4.3    ragg_1.2.7       </span></span>
<span><span class="co">## [53] utf8_1.2.4        munsell_0.5.1     cachem_1.0.8</span></span></code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Elvio Blini.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
