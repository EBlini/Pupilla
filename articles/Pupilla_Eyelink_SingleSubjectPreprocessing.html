<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Pupilla::EyeLink::Read and preprocessing • Pupilla</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Pupilla::EyeLink::Read and preprocessing">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Pupilla</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9001</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/Pupilla.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Pupilla_Advanced_statistical_analyses.html">Pupilla::Advanced statistical analyses</a></li>
    <li><a class="dropdown-item" href="../articles/Pupilla_Assessing_Pupillary_Manifold.html">Pupilla::Assessing_Pupillary_Manifold</a></li>
    <li><a class="dropdown-item" href="../articles/Pupilla_Eyelink_SingleSubjectPreprocessing.html">Pupilla::EyeLink::Read and preprocessing</a></li>
    <li><a class="dropdown-item" href="../articles/Pupilla_TOBII_ReduceFeatures%20-%20Copia.html">Pupilla::TOBII_ReduceFeatures</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/EBlini/Pupilla/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Pupilla::EyeLink::Read and preprocessing</h1>
                        <h4 data-toc-skip class="author">Elvio
Blini</h4>
            
            <h4 data-toc-skip class="date">January 2024</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/EBlini/Pupilla/blob/main/vignettes/Pupilla_Eyelink_SingleSubjectPreprocessing.Rmd" class="external-link"><code>vignettes/Pupilla_Eyelink_SingleSubjectPreprocessing.Rmd</code></a></small>
      <div class="d-none name"><code>Pupilla_Eyelink_SingleSubjectPreprocessing.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p><code>Pupilla</code> gathers several functions that are designed to
facilitate the analysis of pupillometry experiments as commonly
performed in cognitive neuroscience, e.g. event-related designs,
although its use could be much more general.</p>
<p>The typical analysis pipeline would, coarsely, include the following
steps:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Read the data.</strong> This part can vary a lot
depending on the eyetracker used, the individual OS, local paths, how
the experiment was coded, etc. <code>Pupilla</code> does provide utility
functions to read from common eyetrackers (e.g., TOBII, EyeLink) but
clearly this passage will need to be tailored to your files.</p></li>
<li><p><strong>Prepare the data.</strong> As above, this part may need
to be tailored to your specific needs; however, several steps are very
common across pipelines, and will be presented in this
vignette.</p></li>
<li><p><strong>Preprocessing.</strong> Pupillometry needs robust
preprocessing of the raw data, in order to reduce noise and artifacts
(such as those due to blinks). Once the data is properly prepared, this
aspect can be translated across several different scenarios. Of course,
flexibility and adapting to your own data is warmly advised.</p></li>
<li><p><strong>Statistical modelling</strong>. <code>Pupilla</code>
offers two approaches: 1) crossvalidated LMEMs as in <a href="https://link.springer.com/article/10.3758/s13428-022-01957-7" class="external-link">Mathôt
&amp; Vilotijević, 2022</a>); and 2) an original approach through
feature reduction. This vignette does not cover the analysis
step.</p></li>
</ol>
<p>In this vignette we focus on how to read and preprocess data from a
single participant, tested with an EyeLink 1000. There are multiple
differences that may arise in the pipeline, according to the specific
rationale of the experiment and difference in the coding implementation.
These functions have been written having OpenSesame in mind. For this
example we use data from <a href="https://www.biorxiv.org/content/10.1101/2023.12.15.571819v1" class="external-link">Blini
et al., 2023</a>. Data can be retrieved from the associated <a href="https://osf.io/szb24/" class="external-link">OSF repository</a>.</p>
<p>In this study 70 participants (following exclusions) were given an
arithmetic task, preceded by an auditory cue (“easy” or “hard”)
prompting the corresponding difficulty. After a response phase of
variable length, they were given an auditory feedback. All in all, each
trial lasted several seconds. Details are provided in the accompanying
paper, what matters here is that participants were found to have
pupillary <strong>dilation</strong> depending on trial difficulty, that
is a very classic result. We focus on the data of one participant.</p>
<p>Please note that the pipeline and the default parameters in
<code>Pupilla</code> have been changing in the early development phase,
so that results may be slightly different from what reported
elsewhere.</p>
</div>
<div class="section level2">
<h2 id="read-the-data">Read the data<a class="anchor" aria-label="anchor" href="#read-the-data"></a>
</h2>
<p>The library <code>Pupilla</code> must be installed first, and only
once, through <code>devtools</code>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"EBlini/Pupilla"</span><span class="op">)</span></span></code></pre></div>
<p>Dependencies will be installed automatically. We will then need to
load the following packages:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/EBlini/Pupilla" class="external-link">"Pupilla"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://dplyr.tidyverse.org" class="external-link">"dplyr"</a></span><span class="op">)</span> </span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org" class="external-link">"ggplot2"</a></span><span class="op">)</span> </span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://tidyr.tidyverse.org" class="external-link">"tidyr"</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>dplyr.summarise.inform <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>The following steps in this section vary a lot as a function of the
software used for the presentation of the stimuli and your machine.
<code>Pupilla</code> is tested on windows machines, you may thus have
troubles using the utility functions to read all participants
altogether. But this is how you would do in Windows:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#set your own working directory first!</span></span>
<span><span class="co">#wd= choose.dir()</span></span>
<span></span>
<span><span class="va">subject</span><span class="op">=</span> <span class="fl">10</span> <span class="co">#vector of ids; only 1 for this example</span></span>
<span></span>
<span><span class="co">#as coded in the program - these are the relevant eyelink messages</span></span>
<span><span class="va">keep_events</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"fixation"</span>,</span>
<span>  <span class="st">"cue"</span>,</span>
<span>  <span class="st">"target1"</span>,</span>
<span>  <span class="st">"sign"</span>,</span>
<span>  <span class="st">"target2"</span>,</span>
<span>  <span class="st">"calculation"</span>,</span>
<span>  <span class="st">"response"</span>,</span>
<span>  <span class="st">"post_resp_fix"</span>,</span>
<span>  <span class="st">"Wait_Feedback"</span>,</span>
<span>  <span class="st">"feedback"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">#read </span></span>
<span><span class="va">data</span><span class="op">=</span> <span class="fu"><a href="../reference/read_eyelink.html">read_eyelink</a></span><span class="op">(</span><span class="va">subject</span>, <span class="va">keep_events</span>, </span>
<span>                   path <span class="op">=</span> <span class="va">wd</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#split for eyetracker and behavioral data</span></span>
<span><span class="va">ET</span><span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">ET</span></span>
<span><span class="va">BD</span><span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">BD</span></span>
<span></span>
<span><span class="va">ET</span><span class="op">$</span><span class="va">Subject</span><span class="op">=</span> <span class="va">subject</span></span>
<span><span class="va">BD</span><span class="op">$</span><span class="va">Subject</span><span class="op">=</span> <span class="va">subject</span></span></code></pre></div>
<p>As you can see:</p>
<ol style="list-style-type: decimal">
<li>a working directory has been set - change yours!;</li>
<li>we only ask for a specific participant here, but a vector of IDs
could be supplied; each participant comes with two files because by
default OpenSesame splits the eyetracker and behavioral files.</li>
<li>We supplied directly a character vector of events - defined in the
OpenSesame script) that included the relevant phases of the trial. Only
datapoints that belong to these phases are kept. This is mandatory at
this stage.</li>
</ol>
<p>So, reading the files should be straightforward. If this utility
function does not work for you, however, just assume that it works by
iterating <code><a href="https://alexander-pastukhov.github.io/eyelinkReader/reference/read_edf.html" class="external-link">eyelinkReader::read_edf()</a></code> across (eyetracking)
files. In order to use the excellent <code>eyelinkReader</code> package,
you must have installed the SR research-EyeLink plugins, which you can
download from their forum upon registration (these functions are also
needed to control the eyelink).</p>
</div>
<div class="section level2">
<h2 id="prepare-the-data">Prepare the data<a class="anchor" aria-label="anchor" href="#prepare-the-data"></a>
</h2>
<p>I have the bad (?) habit to only record essential info in the
eyetracker file, :)</p>
<p>As a result, very often variables that are only present in the
behavioral file (e.g., response time, condition) must be copied to the
eyetracker file, which has very different dimensions (several lines per
trial, depending on sampling rate). <code>Pupilla</code> has utility
functions to do precisely that.</p>
<p>Specifically, from the behavioral data (BD) we report the variables
Phase, Accuracy, Cue, etc.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#whether it's practice or experiment</span></span>
<span><span class="va">ET</span><span class="op">$</span><span class="va">Phase</span> <span class="op">=</span> <span class="fu"><a href="../reference/copy_variable.html">copy_variable</a></span><span class="op">(</span></span>
<span>  <span class="st">"Phase"</span>,</span>
<span>  id_var <span class="op">=</span> <span class="st">"Subject"</span>,</span>
<span>  constrained_var <span class="op">=</span> <span class="st">"trial"</span>,</span>
<span>  larger_df <span class="op">=</span> <span class="va">ET</span>,</span>
<span>  smaller_df <span class="op">=</span> <span class="va">BD</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#result of the problem</span></span>
<span><span class="va">ET</span><span class="op">$</span><span class="va">Result</span> <span class="op">=</span> <span class="fu"><a href="../reference/copy_variable.html">copy_variable</a></span><span class="op">(</span></span>
<span>  <span class="st">"Result"</span>,</span>
<span>  id_var <span class="op">=</span> <span class="st">"Subject"</span>,</span>
<span>  constrained_var <span class="op">=</span> <span class="st">"trial"</span>,</span>
<span>  larger_df <span class="op">=</span> <span class="va">ET</span>,</span>
<span>  smaller_df <span class="op">=</span> <span class="va">BD</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#response</span></span>
<span><span class="va">ET</span><span class="op">$</span><span class="va">Response</span> <span class="op">=</span> <span class="fu"><a href="../reference/copy_variable.html">copy_variable</a></span><span class="op">(</span></span>
<span>  <span class="st">"response"</span>,</span>
<span>  id_var <span class="op">=</span> <span class="st">"Subject"</span>,</span>
<span>  constrained_var <span class="op">=</span> <span class="st">"trial"</span>,</span>
<span>  larger_df <span class="op">=</span> <span class="va">ET</span>,</span>
<span>  smaller_df <span class="op">=</span> <span class="va">BD</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#set accuracy</span></span>
<span><span class="va">ET</span><span class="op">$</span><span class="va">Accuracy</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">ET</span><span class="op">$</span><span class="va">Response</span> <span class="op">==</span> <span class="va">ET</span><span class="op">$</span><span class="va">Result</span>,</span>
<span>                     <span class="st">"correct"</span>,</span>
<span>                     <span class="st">"incorrect"</span><span class="op">)</span></span>
<span><span class="co">#condition</span></span>
<span><span class="va">ET</span><span class="op">$</span><span class="va">Cue</span> <span class="op">=</span> <span class="fu"><a href="../reference/copy_variable.html">copy_variable</a></span><span class="op">(</span></span>
<span>  <span class="st">"Cue"</span>,</span>
<span>  id_var <span class="op">=</span> <span class="st">"Subject"</span>,</span>
<span>  constrained_var <span class="op">=</span> <span class="st">"trial"</span>,</span>
<span>  larger_df <span class="op">=</span> <span class="va">ET</span>,</span>
<span>  smaller_df <span class="op">=</span> <span class="va">BD</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We discard practice trials:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ET</span><span class="op">=</span> <span class="va">ET</span><span class="op">[</span><span class="va">ET</span><span class="op">$</span><span class="va">Phase</span><span class="op">==</span> <span class="st">"experiment"</span>,<span class="op">]</span></span>
<span><span class="va">BD</span><span class="op">=</span> <span class="va">BD</span><span class="op">[</span><span class="va">BD</span><span class="op">$</span><span class="va">Phase</span><span class="op">==</span> <span class="st">"experiment"</span>,<span class="op">]</span></span></code></pre></div>
<p>In this experiment, we were recording the left eye only. We thus set
the Pupil area as the corresponding variable:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ET</span><span class="op">$</span><span class="va">Pupil</span><span class="op">=</span> <span class="va">ET</span><span class="op">$</span><span class="va">paL</span></span></code></pre></div>
<p>We set to NA when Pupil values are 0. This is mandatory for the
preprocessing functions that follow. Also, although this is very often
automatic, we only retain data samples in which a fixation was recorded
by the eyelink.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#very important, set zeros to NA for preprocessing</span></span>
<span><span class="va">ET</span><span class="op">$</span><span class="va">Pupil</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">ET</span><span class="op">$</span><span class="va">Pupil</span><span class="op">==</span><span class="fl">0</span>, <span class="cn">NA</span>, <span class="va">ET</span><span class="op">$</span><span class="va">Pupil</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ET</span><span class="op">$</span><span class="va">Pupil</span><span class="op">[</span><span class="va">ET</span><span class="op">$</span><span class="va">is_Fixation</span><span class="op">==</span><span class="fl">0</span><span class="op">]</span><span class="op">=</span> <span class="cn">NA</span></span></code></pre></div>
<p>Next, I generally remove values that exceed a certain threshold,
e.g. &lt; - 2.5 standard deviation from the subject’s mean (considering
all samples).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cut_off</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ET</span><span class="op">$</span><span class="va">Pupil</span>, na.rm<span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">-</span> <span class="fl">2.5</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">ET</span><span class="op">$</span><span class="va">Pupil</span>, na.rm<span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">ET</span><span class="op">$</span><span class="va">Pupil</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">ET</span><span class="op">$</span><span class="va">Pupil</span> <span class="op">&lt;</span> <span class="va">cut_off</span>, <span class="cn">NA</span>, <span class="va">ET</span><span class="op">$</span><span class="va">Pupil</span><span class="op">)</span></span></code></pre></div>
<p>We can now realign the timestamps to the first sample of the initial
phase. Then, we downsample to 20 ms bins.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ET</span><span class="op">=</span> <span class="va">ET</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">trial</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Time<span class="op">=</span> <span class="va">time</span><span class="op">-</span><span class="va">time</span><span class="op">[</span><span class="va">Event</span><span class="op">==</span> <span class="st">"fixation"</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> </span></code></pre></div>
</div>
<div class="section level2">
<h2 id="preprocessing">Preprocessing<a class="anchor" aria-label="anchor" href="#preprocessing"></a>
</h2>
<p>We can finally move to the real thing! The signal must be
<strong>processed</strong> so that the impact of artifacts, blinks, etc.
is reduced. The easiest way to do that in <code>Pupilla</code> would be
to use the <code><a href="../reference/pre_process.html">pre_process()</a></code> function. You may want, however,
to consider whether the specific default parameters are applicable to
your data. For a description of the parameters, see
<code>?pp_options()</code>. You can always change the default parameters
by calling the options globally, other than within the function itself.
E.g.:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#the default parameters:</span></span>
<span><span class="fu"><a href="../reference/pp_options.html">pp_options</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $thresh</span></span>
<span><span class="co">## [1] 3</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $speed_method</span></span>
<span><span class="co">## [1] "z"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $extend_by</span></span>
<span><span class="co">## [1] 25</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $island_size</span></span>
<span><span class="co">## [1] 4</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $extend_blink</span></span>
<span><span class="co">## [1] 25</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $overall_thresh</span></span>
<span><span class="co">## [1] 0.4</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $consecutive_thresh</span></span>
<span><span class="co">## NULL</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $spar</span></span>
<span><span class="co">## [1] 0.8</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/pp_options.html">pp_options</a></span><span class="op">(</span><span class="st">"extend_by"</span><span class="op">=</span> <span class="fl">25</span><span class="op">)</span> <span class="co">#strip 50 ms before and after blinks</span></span>
<span><span class="fu"><a href="../reference/pp_options.html">pp_options</a></span><span class="op">(</span><span class="st">"extend_blink"</span><span class="op">=</span> <span class="fl">25</span><span class="op">)</span> <span class="co">#further extend prior to interpolation</span></span>
<span><span class="fu"><a href="../reference/pp_options.html">pp_options</a></span><span class="op">(</span><span class="st">"spar"</span><span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="co">#smoothing parameter</span></span></code></pre></div>
<p>Once checked the defaults, preprocessing only requires:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#entire preprocessing</span></span>
<span><span class="va">ET</span><span class="op">=</span> <span class="va">ET</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Subject</span>, <span class="va">trial</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Pupil_pp<span class="op">=</span> <span class="fu"><a href="../reference/pre_process.html">pre_process</a></span><span class="op">(</span><span class="va">Pupil</span>, <span class="va">Time</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>And that’s it! You can <strong>check</strong> the result of the
pipeline visually as follows:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ET</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Subject</span><span class="op">==</span><span class="fl">10</span> <span class="op">&amp;</span> <span class="va">trial</span><span class="op">==</span> <span class="fl">13</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/check_series.html">check_series</a></span><span class="op">(</span><span class="st">"Pupil"</span>, <span class="st">"Pupil_pp"</span>, <span class="st">"Time"</span><span class="op">)</span></span></code></pre></div>
<p><img src="images%2Ftrial_13-1.png"></p>
<p>Or you can use the function <code><a href="../reference/check_all_series.html">Pupilla::check_all_series()</a></code>
to have all the plots (that is, for all ids and trials) saved as images
in your path.</p>
<p>In the image, the black dots represent the raw, initial data. The red
line depicts instead the reconstructed, preprocessed signal.
<code><a href="../reference/pre_process.html">pre_process()</a></code> simply runs, in order, functions for
deblinking (through a velocity-based criterion), interpolation, and
smoothing through cubic splines. Trials in which data points do not
reach a given quality threshold are set to NA; trials that can be
recovered are, instead, recovered.</p>
<p>So, for those trials in which we couldn’t restore a reliable signal,
we simply discard them!</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#drop</span></span>
<span><span class="va">ET</span><span class="op">=</span> <span class="va">ET</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Pupil_pp</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Another common step is <strong>downsampling</strong>, we choose bins
of 20 ms:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ET</span><span class="op">$</span><span class="va">Time</span><span class="op">=</span> <span class="fu"><a href="../reference/downsample_time.html">downsample_time</a></span><span class="op">(</span><span class="va">ET</span><span class="op">$</span><span class="va">Time</span>, <span class="fl">20</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#summarise the data for the new binned variable</span></span>
<span><span class="va">ET</span><span class="op">=</span> <span class="va">ET</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Subject</span>, <span class="va">Cue</span>, <span class="va">Event</span>, </span>
<span>           <span class="va">trial</span>, <span class="va">Time</span>, <span class="va">Accuracy</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>Pupil<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">Pupil_pp</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Next, I personally prefer to work with <strong>z-scores</strong>
instead of arbitrary units or mms, as to have a standardized measure.
So:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#z scores</span></span>
<span><span class="va">ET</span><span class="op">$</span><span class="va">Pupil_raw</span><span class="op">=</span> <span class="va">ET</span><span class="op">$</span><span class="va">Pupil</span></span>
<span></span>
<span><span class="va">ET</span><span class="op">=</span> <span class="va">ET</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Subject</span>, <span class="va">trial</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Pupil<span class="op">=</span> <span class="op">(</span><span class="op">(</span><span class="va">Pupil</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Pupil</span><span class="op">[</span><span class="va">Event</span><span class="op">!=</span> <span class="st">"response"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">Pupil</span><span class="op">[</span><span class="va">Event</span><span class="op">!=</span> <span class="st">"response"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>In this particular case I did not include the response phase because
of the motor artifacts (verbal response and blinks allowed), but this
should not alter much the pattern of the results.</p>
<p>If needed, we can remove here trials in which the starting pupil size
was particularly extreme.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">deviant_baseline</span><span class="op">=</span> <span class="va">ET</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Subject</span>, <span class="va">trial</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>Baseline_ps<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">Pupil</span><span class="op">[</span><span class="va">Event</span><span class="op">==</span> <span class="st">"fixation"</span><span class="op">]</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">deviant_baseline</span><span class="op">$</span><span class="va">Baseline_ps</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">deviant_baseline</span><span class="op">$</span><span class="va">Baseline_ps</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#to omit</span></span>
<span><span class="va">omit</span><span class="op">=</span> <span class="va">deviant_baseline</span><span class="op">$</span><span class="va">trial</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">deviant_baseline</span><span class="op">$</span><span class="va">Baseline_ps</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">2</span><span class="op">]</span> </span>
<span><span class="va">omit</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="va">omit</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">omit</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">ET</span><span class="op">=</span> <span class="va">ET</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">trial</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">omit</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The last, crucial step is the <strong>baseline subtraction</strong>.
In analogy to what done in the paper I simply realign the traces to the
median of the fixation phase.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ET</span><span class="op">=</span> <span class="va">ET</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Subject</span>, <span class="va">trial</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Pupil<span class="op">=</span> <span class="va">Pupil</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">Pupil</span><span class="op">[</span><span class="va">Event</span><span class="op">==</span> <span class="st">"fixation"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We are done!</p>
<p>One way to save the preprocessed files would be:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#save preprocessed data for modelling</span></span>
<span><span class="va">ppdataaddress</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"pp_data//subj_"</span>, <span class="va">subj</span>, <span class="st">".RDS"</span><span class="op">)</span> </span>
<span>  </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">ET</span>, file <span class="op">=</span> <span class="va">ppdataaddress</span><span class="op">)</span></span></code></pre></div>
<p>In this way the group analysis would be faster.</p>
<p>Below I depict the data for this particular participant.</p>
<p><img src="images%2Fmath_anxiety_subj_10-1.png"></p>
</div>
<div class="section level2">
<h2 id="appendix">Appendix<a class="anchor" aria-label="anchor" href="#appendix"></a>
</h2>
<p>Packages’ versions:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Elvio Blini.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
